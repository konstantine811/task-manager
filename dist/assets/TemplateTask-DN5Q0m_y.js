import{r as m,j as a,b as mt,T as q,c as ft,d as J,e as ht}from"./index-I-f6NN0M.js";import{D as pt,a as xt,b as gt,c as yt,d as wt,e as St,f as jt,C as Tt,n as vt,T as bt,M as Ct,r as kt,P as _t,g as Nt}from"./custom-drawer-BaOMj-pF.js";import{u as Dt,s as P,a as V,l as At,b as Et,c as It,p as Mt,i as Rt,C as rt,S as $t,B as Pt,d as zt,e as Ot,f as Lt}from"./touch-inspect-CKXOG-wf.js";import{m as Ht,a as Bt,u as st,b as at,i as Gt,c as K}from"./headerSizeStore-82m5FhoW.js";import{I as O,g as Vt,s as Ft,m as Wt,b as Kt,C as Xt,T as C}from"./chart-pie-item-Dvt4cEAa.js";import{c as Yt,u as L}from"./addLeadingZeros-Cf7AxCAV.js";import{C as Ut}from"./chart-column-B2-pbhjZ.js";import{u as qt,a as Jt}from"./use-spring-cNoCArSl.js";import"./trending-up-DJX-bNRx.js";import"./users-NoHdSWef.js";import"./check-Cv3J71aq.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]],F=Yt("chart-pie",Qt),ot=m.createContext(null);function Zt(t,n,s,o){if(!o)return t;const e=t.findIndex(d=>d.value===n);if(e===-1)return t;const i=o>0?1:-1,c=t[e+i];if(!c)return t;const l=t[e],u=c.layout,h=Ht(u.min,u.max,.5);return i===1&&l.layout.max+s>h||i===-1&&l.layout.min+s<h?Bt(t,e,e+i):t}function te({children:t,as:n="ul",axis:s="y",onReorder:o,values:e,...i},c){const l=st(()=>at[n]),u=[],h=m.useRef(!1),d=m.useRef(null),g={axis:s,groupRef:d,registerItem:(f,T)=>{const w=u.findIndex(y=>f===y.value);w!==-1?u[w].layout=T[s]:u.push({value:f,layout:T[s]}),u.sort(re)},updateOrder:(f,T,w)=>{if(h.current)return;const y=Zt(u,f,T,w);u!==y&&(h.current=!0,o(y.map(ne).filter(j=>e.indexOf(j)!==-1)))}};m.useEffect(()=>{h.current=!1});const _=f=>{d.current=f,typeof c=="function"?c(f):c&&(c.current=f)},p={overflowAnchor:"none",...i.style};return a.jsx(l,{...i,style:p,ref:_,ignoreStrict:!0,children:a.jsx(ot.Provider,{value:g,children:t})})}const ee=m.forwardRef(te);function ne(t){return t.value}function re(t,n){return t.layout.min-n.layout.min}const z=50,Q=25,se=new Set(["auto","scroll"]),I=new WeakMap,M=new WeakMap;let E=null;function ae(){if(E){const t=W(E,"y");t&&(M.delete(t),I.delete(t));const n=W(E,"x");n&&n!==t&&(M.delete(n),I.delete(n)),E=null}}function oe(t,n){const s=getComputedStyle(t),o=n==="x"?s.overflowX:s.overflowY,e=t===document.body||t===document.documentElement;return se.has(o)||e}function W(t,n){let s=t==null?void 0:t.parentElement;for(;s;){if(oe(s,n))return s;s=s.parentElement}return null}function ce(t,n,s){const o=n.getBoundingClientRect(),e=s==="x"?Math.max(0,o.left):Math.max(0,o.top),i=s==="x"?Math.min(window.innerWidth,o.right):Math.min(window.innerHeight,o.bottom),c=t-e,l=i-t;if(c<z){const u=1-c/z;return{amount:-Q*u*u,edge:"start"}}else if(l<z){const u=1-l/z;return{amount:Q*u*u,edge:"end"}}return{amount:0,edge:null}}function ie(t,n,s,o){if(!t)return;E=t;const e=W(t,s);if(!e)return;const i=n-(s==="x"?window.scrollX:window.scrollY),{amount:c,edge:l}=ce(i,e,s);if(l===null){M.delete(e),I.delete(e);return}const u=M.get(e),h=e===document.body||e===document.documentElement;if(u!==l){if(!(l==="start"&&o<0||l==="end"&&o>0))return;M.set(e,l);const g=s==="x"?e.scrollWidth-(h?window.innerWidth:e.clientWidth):e.scrollHeight-(h?window.innerHeight:e.clientHeight);I.set(e,g)}if(c>0){const d=I.get(e);if((s==="x"?h?window.scrollX:e.scrollLeft:h?window.scrollY:e.scrollTop)>=d)return}s==="x"?h?window.scrollBy({left:c}):e.scrollLeft+=c:h?window.scrollBy({top:c}):e.scrollTop+=c}function Z(t,n=0){return Gt(t)?t:Jt(n)}function le({children:t,style:n={},value:s,as:o="li",onDrag:e,onDragEnd:i,layout:c=!0,...l},u){const h=st(()=>at[o]),d=m.useContext(ot),g={x:Z(n.x),y:Z(n.y)},_=qt([g.x,g.y],([y,j])=>y||j?1:"unset"),{axis:p,registerItem:f,updateOrder:T,groupRef:w}=d;return a.jsx(h,{drag:p,...l,dragSnapToOrigin:!0,style:{...n,x:g.x,y:g.y,zIndex:_},layout:c,onDrag:(y,j)=>{const{velocity:v,point:N}=j,A=g[p].get();T(s,A,v[p]),ie(w.current,N[p],p,v[p]),e&&e(y,j)},onDragEnd:(y,j)=>{ae(),i&&i(y,j)},onLayoutMeasure:y=>{f(s,y)},ref:u,ignoreStrict:!0,children:t})}const ue=m.forwardRef(le),de=t=>{const n={},s=[];return t.forEach(o=>{o.tasks.forEach(e=>{e.whenDo.forEach(i=>{n[i]||(n[i]={totalTime:0,categories:[],tasks:[]});const c=e.isDetermined?e.timeDone:e.time;n[i].totalTime+=c,n[i].categories.includes(o.title)||n[i].categories.push(o.title),n[i].tasks.push(e),s.push({day:i,title:e.title,duration:c})})})}),{weekTaskEntity:n,flattenTasks:s}},me=(t,n="by_all_week",s=O.category)=>{const o={};return t.forEach(e=>{e.tasks.forEach(i=>{const c=i.isDetermined?i.timeDone:i.time,l=s===O.category?e.title:i.title;fe(o,l,n,i,c)})}),o};function fe(t,n,s,o,e){if(s==="all"||s==="by_all_week"&&o.whenDo.length>0||o.whenDo.includes(s)){const c=(s==="all"||s==="by_all_week")&&o.whenDo.length||1;t[n]??(t[n]=0),t[n]+=e*c}}const he=({templateTasks:t})=>{const[n,s]=m.useState(),o=K(p=>p.size),[e]=L(),i=mt(p=>p.selectedTheme),{TooltipElement:c,showTooltip:l,hideTooltip:u}=Dt(),h=m.useRef(null),d=m.useRef(null);m.useEffect(()=>{const p=de(t);s(p)},[t]);const g=m.useCallback(p=>{P(p).attr("class","fill-transparent")},[]),_=m.useCallback((p,f,T)=>{const w=d.current;if(w&&w===f){g(f),u(),d.current=null;return}w&&w!==f&&(g(w),u()),d.current=f;const y=p.currentTarget.parentNode;if(!y)return;const v=P(y).datum().key,N=T[1]-T[0];P(f).attr("class","fill-white/20"),l({event:p,title:v,time:N})},[l,u,g]);return m.useEffect(()=>{if(!h.current||!n)return;const p=n.flattenTasks,f={top:20,right:20,bottom:30,left:70},T=800,w=600,y=40,j=T-f.left-f.right,v=w-f.top-f.bottom,N=q[i??J.DARK]??q[J.DARK],A=P(h.current);A.selectAll("*").remove();const k=A.attr("viewBox",`0 0 ${T} ${w+y}`).append("g").attr("transform",`translate(${f.left},${f.top})`),ct=Vt(p,r=>r.day),R=Array.from(ct,([r,x])=>{const D={day:r};return x.forEach(G=>{D[G.title]=typeof G.duration=="number"?G.duration:0}),D}),$=Array.from(new Set(p.map(r=>r.title))),H=new Map;$.forEach(r=>{const x=V(p.filter(D=>D.title===r).map(D=>D.duration||0));H.set(r,x)});const it=[...$].sort((r,x)=>(H.get(r)??0)-(H.get(x)??0)),lt=Ft().keys(it)(R),ut=Wt(R,r=>V($,x=>r[x]||0))||0,X=Math.ceil(ut/3600),Y=Array.from({length:X+1},(r,x)=>x*3600),b=Kt().domain(R.map(r=>r.day.toString())).range([0,j]).padding(.6),S=At().domain([0,X*3600]).nice().range([v,0]);k.append("g").attr("transform",`translate(0, ${v})`).attr("class","text-zinc-400 text-[14px]").call(Et(b).tickFormat(r=>e(`task_manager.day_names.${r}`))).call(r=>{r.select(".domain").remove(),r.selectAll(".tick line").remove()}),k.append("g").attr("transform",`translate(${f.right-20},0)`).attr("class","text-zinc-400 text-md").call(It(S).tickValues(Y).tickFormat(r=>{const{hours:x}=Mt(r);return String(Number(x))})).call(r=>{r.selectAll(".domain").remove(),r.selectAll(".tick line").remove()}),k.append("g").selectAll("line.grid-x").data(b.domain()).join("line").attr("class","grid-x stroke stroke-white/10").attr("x1",r=>b(r)+b.bandwidth()/2).attr("x2",r=>b(r)+b.bandwidth()/2).attr("y1",0).attr("y2",v),k.append("g").selectAll("line.grid-y").data(Y).join("line").attr("class","grid-y").attr("x1",0).attr("x2",j).attr("y1",r=>S(r)).attr("y2",r=>S(r)).attr("stroke","rgba(255,255,255,0.08)").attr("stroke-width",1),k.append("g").append("text").attr("x",-v/2).attr("y",-30).attr("text-anchor","middle").attr("class","fill-zinc-400 text-lg -rotate-90").text(e("chart.hours")),k.append("text").attr("x",j/2).attr("y",v+f.bottom+10).attr("text-anchor","middle").attr("font-size",14).attr("class","fill-zinc-400 text-lg").text(e("chart.days"));const dt=R.map(r=>({day:r.day,total:V($,x=>r[x]||0)})),B=A.append("defs").append("linearGradient").attr("id","barGradient").attr("gradientUnits","userSpaceOnUse").attr("x1","0").attr("y1",S(0)).attr("x2","0").attr("y2",S(18*3600));B.append("stop").attr("offset","40%").attr("stop-color",N.accent),B.append("stop").attr("offset",`${(1-S(20*3600)/S(0))*100}%`).attr("stop-color",ft.yellow),B.append("stop").attr("offset",`${(1-S(40*3600)/S(0))*100}%`).attr("stop-color",N.destructive),k.append("g").selectAll("rect").data(dt).join("rect").attr("x",r=>b(r.day.toString())).attr("y",r=>S(r.total)).attr("width",b.bandwidth()).attr("height",r=>S(0)-S(r.total)).attr("rx",8).attr("fill","url(#barGradient)");const U=k.selectAll("g.layer-outline").data(lt).join("g").attr("class","stroke fill-transparent").attr("stroke","rgba(255,255,255,0.08)").selectAll("rect").data(r=>r).join("rect").attr("x",r=>b(r.data.day.toString())).attr("y",r=>S(r[1])).attr("height",r=>{const x=S(r[0])-S(r[1]);return isNaN(x)?0:x}).attr("width",b.bandwidth()).attr("rx",4).attr("id",r=>`rect-${r.data.day}-${r[0]}-${r[1]}`);Rt?U.on("pointerdown",function(r,x){_(r,this,x)}):U.on("pointerenter",function(r,x){_(r,this,x)}).on("mouseleave",function(){d.current===this&&(g(this),u(),d.current=null)})},[n,h,o,e,i,l,u,_,g]),a.jsxs("div",{className:"w-full relative",children:[a.jsx(rt,{title:"chart.count_chart_title"}),c,a.jsx("svg",{ref:h,className:"w-full h-auto"})]})},pe=["all","by_all_week",1,2,3,4,5,6,7],tt=pe,xe=({onChange:t})=>{const n=tt[0],[s,o]=m.useState(n);function e(c){return isNaN(Number(c))?c:Number(c)}m.useEffect(()=>{t(n)},[t,n]);const[i]=L();return a.jsxs(pt,{children:[a.jsx(xt,{asChild:!0,children:a.jsx("div",{className:"inline-block",children:a.jsx($t,{animValue:1,children:a.jsx(Pt,{className:"w-56 bg-zinc-900/80 border-white/5 hover:border-white/10 hover:bg-zinc-800/80 text-zinc-300",variant:"outline",children:i(`task_manager.day_names.${s}`)})})})}),a.jsxs(gt,{className:"w-56 chrono-dropdown-content",children:[a.jsx(yt,{children:i("chart.period")}),a.jsx(wt,{}),a.jsx(St,{value:s,onValueChange:c=>{o(c),t(e(c))},children:tt.map(c=>a.jsx(jt,{value:c.toString(),children:i(`task_manager.day_names.${c}`)},c))})]})]})},et=({templateTasks:t,title:n,type:s})=>{const[o,e]=m.useState(),i="all",[c,l]=m.useState(i);return m.useEffect(()=>{const u=me(t,c,s);e(u)},[t,c,s]),a.jsx(a.Fragment,{children:o&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2",children:[a.jsx(rt,{title:n}),a.jsx(xe,{onChange:l})]}),a.jsx("div",{className:"max-w-md mx-auto",children:a.jsx(Xt,{data:o,type:s})})]})})},ge=()=>({[C.category]:{title:"chart.period_count_category_title",icon:a.jsx(F,{className:"h-4"})},[C.task]:{title:"chart.period_count_task_title",icon:a.jsx(F,{className:"h-4"})},[C.timeCount]:{title:"chart.period_count_person_title",icon:a.jsx(Ut,{className:"h-4"})}}),ye=({onToggleItems:t})=>{const[n,s]=m.useState([C.timeCount,C.category,C.task]),[o,e]=m.useState([...n]),i=ge(),[c]=L();return m.useEffect(()=>{const l=o.filter(u=>n.includes(u));t(l)},[n,o,t]),a.jsx(ee,{axis:"x",values:o,onReorder:e,className:"flex gap-1",children:o.map(l=>{var u;return a.jsx(ue,{value:l,whileDrag:{scale:1.15},className:"cursor-grab",children:a.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-lg transition select-none flex-wrap ${n.includes(l)?"chrono-chart-toggle selected text-indigo-200":"chrono-chart-toggle text-zinc-400"}`,children:[a.jsx(Tt,{id:l,checked:n.includes(l),onCheckedChange:h=>{s(h?d=>[...d,l]:d=>d.filter(g=>g!==l))}}),((u=i[l])==null?void 0:u.icon)||a.jsx(F,{}),a.jsx("span",{className:"text-xs",children:c(`chart.${l}`)})]})},l)})})},we=t=>{const n=vt(t);return n.length<=1?0:n.reduce((s,o)=>s+(o.isDetermined?o.timeDone:o.time),0)},nt=({templateTasks:t})=>{const[n,s]=m.useState([]),o=K(e=>e.size);return a.jsx(a.Fragment,{children:we(t)>0&&a.jsxs("div",{className:"w-auto pt-8 sticky top-0",style:{top:`${o}px`},children:[a.jsx("div",{className:"flex justify-center mb-2",children:a.jsx(ye,{onToggleItems:s})}),n.map(e=>{switch(e){case C.timeCount:return a.jsx(he,{templateTasks:t},e);case C.category:return a.jsx(et,{templateTasks:t,title:"chart.period_count_category_title",type:O.category},e);case C.task:return a.jsx(et,{templateTasks:t,title:"chart.period_count_task_title",type:O.task},e);default:return null}})]})})},Ie=()=>{const t=ht(),{isAdoptiveSize:n}=zt("md"),[s,o]=m.useState([]),[e,i]=m.useState([]),[c,l]=m.useState(!1),u=K(d=>d.size),[h]=L();return m.useEffect(()=>{l(!0),Ot().then(d=>{d?(o(d),i(d)):(o([]),i([])),l(!1)}).catch(d=>{console.error("Error loading tasks:",d),l(!1)})},[]),a.jsxs("div",{className:"flex w-full",style:{minHeight:`calc(100vh - ${u}px)`},children:[a.jsx("div",{className:"flex-1"}),a.jsx("main",{className:`w-full max-w-2xl px-4 flex flex-col justify-center ${t.className}`,style:{minHeight:`calc(100vh - ${u}px)`},children:c?a.jsx(_t,{}):a.jsxs("div",{className:"max-w-2xl w-full m-auto",children:[a.jsx("h2",{className:"text-center text-foreground/50 text-sm mb-4 mt-2",children:h("task_manager.template_daily_task_title")}),a.jsx(bt,{children:a.jsx(Ct,{strategy:kt,vertical:!0,trashable:!0,templated:!0,items:s,onChangeTasks:d=>{Lt(d),setTimeout(()=>{i(d)},0)}})})]})}),a.jsx("div",{className:"flex-1 relative",children:n?a.jsx(Nt,{title:"task_manager.analytics.header.title",description:"task_manager.analytics.header.description",children:a.jsx(nt,{templateTasks:e})}):a.jsx(nt,{templateTasks:e})})]})};export{Ie as default};
